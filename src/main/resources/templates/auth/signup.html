<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>회원가입 | OutSpecs</title>
    <link rel="stylesheet" th:href="@{/css/pages/signup.css}">
</head>
<body class="auth-bg">
    <header th:replace="~{fragments/header :: header}"></header>
    <main class="auth-wrapper">
        <section class="auth-card">
            <img class="auth-logo"
                 th:src="@{/css/images/logo.svg}"
                 alt="OutSpecs 로고" />

            <form th:action="@{/users/signup}"
                  th:object="${userDTO}"
                  method="post"
                  id="signupForm"
                  class="auth-form"
                  novalidate>

                <!-- USERNAME -->
                <div class="field">
                    <label for="username">이메일</label>
                    <input type="text"
                           id="username"
                           th:field="*{username}"
                           placeholder="예: user@naver.com"
                           required
                           class="auth-input" />
                    <div th:if="${#fields.hasErrors('username')}"
                         th:errors="*{username}"
                         class="error-text"></div>
                    <div id="usernameError" class="error-text"></div>
                </div>

                <!-- PASSWORD -->
                <div class="field">
                    <label for="password">비밀번호</label>
                    <input type="password"
                           id="password"
                           th:field="*{password}"
                           placeholder="영문·숫자·특수문자 포함 8자 이상"
                           required
                           autocomplete="off"
                           class="auth-input" />
                    <div th:if="${#fields.hasErrors('password')}"
                         th:errors="*{password}"
                         class="error-text"></div>
                    <div id="passwordError" class="error-text"></div>
                </div>

                <!-- CONFIRM PASSWORD -->
                <div class="field">
                    <label for="confirmPassword">비밀번호 확인</label>
                    <input type="password"
                           id="confirmPassword"
                           name="confirmPassword"
                           placeholder="비밀번호 재입력"
                           required
                           autocomplete="off"
                           class="auth-input" />
                    <div id="confirmError" class="error-text"></div>
                </div>

                <button type="submit" class="auth-primary">회원가입</button>

                <div class="or">또는</div>

                <!-- 구글 회원가입(원한다면 th:href 연결) -->
                <a class="google-btn" th:href="@{/oauth2/authorization/google}">
                    <img th:src="@{/css/images/google_icon.svg}" alt="구글 로그인">
                    Google 계정으로 계속하기
                </a>

                <p class="auth-footer">
                    이미 계정이 있으신가요?
                    <a th:href="@{/users/login}">로그인</a>
                </p>
            </form>
        </section>
    </main>
    <script>
          const form = document.getElementById('signupForm');
          form.addEventListener('submit', function(e) {
            let valid = true;
            const emailPat = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;
            const passPat  = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&]).{8,}$/;

            // 이메일 검증
            const email = this.username.value.trim();
            const emailErrEl = document.getElementById('usernameError');
            if (!emailPat.test(email)) {
              emailErrEl.textContent = '유효한 이메일 형식을 입력해주세요.';
              valid = false;
            } else {
              emailErrEl.textContent = '';
            }

            // 비밀번호 검증
            const pw = this.password.value;
            const pwErrEl = document.getElementById('passwordError');
            if (!passPat.test(pw)) {
              pwErrEl.textContent = '비밀번호는 영문·숫자·특수문자 포함 8자 이상이어야 합니다.';
              valid = false;
            } else {
              pwErrEl.textContent = '';
            }

            // 비밀번호 확인
            const cpw = document.getElementById('confirmPassword').value;
            const cpwErrEl = document.getElementById('confirmError');
            if (cpw !== pw) {
              cpwErrEl.textContent = '비밀번호가 일치하지 않습니다.';
              valid = false;
            } else {
              cpwErrEl.textContent = '';
            }

            if (!valid) e.preventDefault();
          });
    </script>
</body>
</html>